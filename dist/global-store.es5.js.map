{"version":3,"sources":["webpack://GlobalStore/webpack/bootstrap","webpack://GlobalStore/./src/util.ts","webpack://GlobalStore/./src/createStore.ts","webpack://GlobalStore/./src/compareVersion.ts","webpack://GlobalStore/./src/createReadonlyStore.ts","webpack://GlobalStore/./src/errors.ts","webpack://GlobalStore/./src/index.ts","webpack://GlobalStore/./src/createAsyncReadonlyStore.ts","webpack://GlobalStore/./src/createAsyncStore.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","compareVersion_1","getStore","stores","id","moduleStore","moduleName","versions","initializers","sortByVersion","storeCreators","sort","a","b","compareVersion","version","getStoreValue","initStoreValue","initializer","store","indexOf","push","resetStoreValue","reduce","resolveCreators","createStore","forEach","_a","resolve","util_1","reset","toVersionArray","v","split","map","Number","parseInt","processed","current","v1","v2","errors_1","readonlyStores","freezeArray","storeValue","k","Array","isArray","freeze","createReadonlyStore","isLocked","disabled","disableProtection","Prohibited","AccessedBeforeLock","writeable","lock","finalizer","keys","updateStoreValue","getOwnPropertySymbols","this","_super","action","_this","setPrototypeOf","_newTarget","__extends","Error","__export","createStore_1","default","createReadonlyStore_1","asyncReadonlyStoreCreators","createAsyncReadonlyStore","Promise","creatorsOfModules","initializeAsyncReadonlyStore","asyncStoreCreators","createAsyncStore","initializeAsyncStore"],"mappings":"4BACA,IAAAA,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QA0DA,OArDAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,GAIAlC,IAAAmC,EAAA,mFClFA,IAAAC,EAAApC,EAAA,GA4BA,SAAgBqC,EAASC,EAAgBC,GACvC,IAAMC,EAAcF,EAAOC,EAAGE,YAAcH,EAAOC,EAAGE,aAAe,GACrE,OAAOD,EAAYD,EAAGZ,KAAca,EAAYD,EAAGZ,MAAe,CAAEe,SAAU,GAAIrB,MAAO,GAAIsB,aAAc,IAO7G,SAAgBC,EAAiBC,GAC/B,OAAOA,EAAcC,KAAK,SAACC,EAAGC,GAAM,OAAAZ,EAAAa,eAAeF,EAAEG,QAASF,EAAEE,WAlClEhD,EAAAiD,cAAA,SAA8Bb,EAAgBC,GAC5C,OAAOF,EAASC,EAAQC,GAAIlB,OAG9BnB,EAAAkD,eAAA,SAAqDd,EAAgBC,EAAaW,EAAuBG,GACvG,IAAMC,EAAQjB,EAASC,EAAQC,IACzBe,EAAMZ,SAASa,QAAQL,KAC3BI,EAAMX,aAAaa,KAAKH,GACxBC,EAAMjC,MAAQgC,EAAYC,EAAMjC,MAAYiC,EAAMZ,UAClDY,EAAMZ,SAASc,KAAKN,KAIxBhD,EAAAuD,gBAAA,SAAgCnB,EAAgBC,GAC9C,IAAMe,EAAQjB,EAASC,EAAQC,GACzBG,EAAWY,EAAMZ,SACvBY,EAAMZ,SAAW,GACjBY,EAAMjC,MAAQiC,EAAMX,aAAae,OAAO,SAACrC,EAAOgC,EAAajD,GAG3D,OAFAiB,EAAQgC,EAAYhC,EAAOiC,EAAMZ,UACjCY,EAAMZ,SAASc,KAAKd,EAAStC,IACtBiB,GACN,KAGLnB,EAAAmC,WAKAnC,EAAAyD,gBAAA,SAAmClB,EAAoBd,EAAakB,EAAuCe,GACzGhB,EAAcC,GAAegB,QAAQ,SAACC,OAAEZ,EAAAY,EAAAZ,QAASa,EAAAD,EAAAC,QAASV,EAAAS,EAAAT,YAAkB,OAAAU,EAAQH,EAAY,CAAEnB,WAAUA,EAAEd,IAAGA,EAAEuB,QAAOA,EAAEG,YAAWA,QAGzInD,EAAA0C,+FCnCA,IAAAoB,EAAAhE,EAAA,GAcMsC,EAAiB,GAMvBpC,EAAA0D,YAAA,SAEEE,OAAErB,EAAAqB,EAAArB,WAAYd,EAAAmC,EAAAnC,IAAKuB,EAAAY,EAAAZ,QAASG,EAAAS,EAAAT,YAG5B,OAFAW,EAAAZ,eAAed,EAAQ,CAAEG,WAAUA,EAAEd,IAAGA,GAAIuB,EAASG,GAE9C,CACLhC,YAAc,OAAO2C,EAAAb,cAAcb,EAAQ,CAAEG,WAAUA,EAAEd,IAAGA,KAC5DsC,MAAO,WAAM,OAAAD,EAAAP,gBAAgBnB,EAAQ,CAAEG,WAAUA,EAAEd,IAAGA,qCCd1D,SAASuC,EAAeC,GACtB,MAAoB,iBAANA,EAAiB,CAAC,EAAG,EAAGA,GACpCA,EAAEC,MAAM,KAAKC,IAAI,SAAAF,GAAK,OAAAG,OAAOC,SAASJ,EAAG,uDAV7CjE,EAAA+C,eAAA,SAA+BuB,EAAyBC,GACtD,IAAMC,EAAKR,EAAeM,GACpBG,EAAKT,EAAeO,GAC1B,OAAOC,EAAG,KAAOC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAClCD,EAAG,KAAOC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,mFCXjB,IAAAC,EAAA5E,EAAA,GAGAgE,EAAAhE,EAAA,GAEM6E,EAAyB,GA0F/B,SAASC,EAAYC,EAAwBC,GAC3C,IAAM3D,EAAQ0D,EAAWC,GACrBC,MAAMC,QAAQ7D,KAChB0D,EAAWC,GAAKlE,OAAOqE,OAAO9D,IA7DlCnB,EAAAkF,oBAAA,SAEEtB,OAAErB,EAAAqB,EAAArB,WAAYd,EAAAmC,EAAAnC,IAAKuB,EAAAY,EAAAZ,QAASG,EAAAS,EAAAT,YAC5BW,EAAAZ,eAAeyB,EAAgB,CAAEpC,WAAUA,EAAEd,IAAGA,GAAIuB,EAASG,GAC7D,IAAIgC,GAAW,EACXC,GAAW,EACf,MAAO,CACLC,kBAAiB,WACf,GAAIF,EAAU,MAAM,IAAIT,EAAAY,WAAW/C,EAAY,mCAC/C6C,GAAW,GAEbjE,YACE,IAAKiE,IAAaD,EAAU,MAAM,IAAIT,EAAAa,mBAAmBhD,GACzD,OAAOuB,EAAAb,cAAc0B,EAAgB,CAAEpC,WAAUA,EAAEd,IAAGA,KAExD+D,gBACE,IAAKJ,GAAYD,EAAU,MAAM,IAAIT,EAAAY,WAAW/C,EAAY,6BAC5D,OAAOuB,EAAAb,cAAc0B,EAAgB,CAAEpC,WAAUA,EAAEd,IAAGA,KAExDgE,KAAI,SAACC,GA6BT,IAAqBb,EALKzC,EAAgBC,EAClCe,EAhBF,OARKgC,GAAaD,IACZO,GAiBZ,SAA0BtD,EAAgBC,EAAaqD,GACrD,IAAMnB,EAAUT,EAAAb,cAAcb,EAAQC,GACtCzB,OAAO+E,KAAKD,GAAW/B,QAAQ,SAAAmB,GAAK,OAAAP,EAAQO,GAAKY,EAAUZ,GAAGP,EAAQO,MAlB9Dc,CAAiBjB,EAAgB,CAAEpC,WAAUA,EAAEd,IAAGA,GAAIiE,GAqBtCtD,EAnBDuC,EAmBiBtC,EAnBD,CAAEE,WAAUA,EAAEd,IAAGA,IAoBlD2B,EAAQU,EAAA3B,SAASC,EAAQC,IACzBlB,OAGa0D,EAHOzB,EAAMjC,MAIhCP,OAAO+E,KAAKd,GAAYlB,QAAQ,SAAAmB,GAAK,OAAAF,EAAYC,EAAYC,KAEzDlE,OAAOiF,uBACTjF,OAAOiF,sBAAsBhB,GAAYlB,QAAQ,SAAAmB,GAAK,OAAAF,EAAYC,EAAYC,KAGzElE,OAAOqE,OAAOJ,IA9BfM,GAAW,EACXC,GAAW,GAENU,MAET/B,MAAK,WACH,IAAKqB,GAAYD,EAAU,MAAM,IAAIT,EAAAY,WAAW/C,EAAY,uBAC5DuB,EAAAP,gBAAgBoB,EAAgB,CAAEpC,WAAUA,EAAEd,IAAGA,saCtEvD,IAAA6D,EAAA,SAAAS,GACE,SAAAT,EAAmB/C,EAA2ByD,0BAA9CC,EACEF,EAAA1F,KAAAyF,KAAM,sBAAsBE,EAAM,oCAAoCzD,EAAU,MAAIuD,YADnEG,EAAA1D,aAA2B0D,EAAAD,SAG5CpF,OAAOsF,eAAeD,EAAME,EAAWrE,aAE3C,OANgCsE,EAAAd,EAAAS,GAMhCT,EANA,CAAgCe,OAAnBrG,EAAAsF,aAQb,IAAAC,EAAA,SAAAQ,GACE,SAAAR,EAAmBhD,0BAAnB0D,EACEF,EAAA1F,KAAAyF,KAAM,0BAA0BvD,EAAU,oFAAoFA,EAAU,yBAAuBuD,YAD9IG,EAAA1D,aAGjB3B,OAAOsF,eAAeD,EAAME,EAAWrE,aAE3C,OANwCsE,EAAAb,EAAAQ,GAMxCR,EANA,CAAwCc,OAA3BrG,EAAAuF,kKCRbe,EAAAxG,EAAA,IACAwG,EAAAxG,EAAA,IACAwG,EAAAxG,EAAA,IACAwG,EAAAxG,EAAA,IACAwG,EAAAxG,EAAA,IACA,IAAAyG,EAAAzG,EAAA,GAASE,EAAAwG,QAAAD,EAAA7C,YACT4C,EAAAxG,EAAA,IACAwG,EAAAxG,EAAA,mFCPA,IAAA2G,EAAA3G,EAAA,GAGAgE,EAAAhE,EAAA,GAEM4G,EAAgE,GAMtE1G,EAAA2G,yBAAA,SACE/C,OAAErB,EAAAqB,EAAArB,WAAYd,EAAAmC,EAAAnC,IAAKuB,EAAAY,EAAAZ,QAASG,EAAAS,EAAAT,YAC5B,OAAO,IAAIyD,QAAQ,SAAA/C,GACjB,IAAMgD,EAAoBH,EAA2BnE,GAAcmE,EAA2BnE,IAAe,IACvFsE,EAAkBpF,GAAcoF,EAAkBpF,IAAe,IACzE6B,KAAK,CAAEN,QAAOA,EAAEa,QAAOA,EAAEV,YAAWA,OAQtDnD,EAAA8G,6BAAA,SAA6CvE,EAAoBd,GAC/D,IAAMoF,EAAoBH,EAA2BnE,GACrD,GAAKsE,EAEL,GAAIpF,EAAK,CACP,IAAMkB,EAAgBkE,EAAkBpF,GACxCqC,EAAAL,gBAAgBlB,EAAYd,EAAKkB,EAAe8D,EAAAvB,0BAGhDtE,OAAO+E,KAAKkB,GAAmBlD,QAAQ,SAAAmB,GACrC,IAAMnC,EAAgBkE,EAAkB/B,GACxChB,EAAAL,gBAAgBlB,EAAYuC,EAAGnC,EAAe8D,EAAAvB,q8CCnCpD,IAAAqB,EAAAzG,EAAA,GAEAgE,EAAAhE,EAAA,GAGMiH,EAAgD,GAMtD/G,EAAAgH,iBAAA,SAA6DpD,OAAErB,EAAAqB,EAAArB,WAAYd,EAAAmC,EAAAnC,IAAKuB,EAAAY,EAAAZ,QAASG,EAAAS,EAAAT,iCAAiCyD,QAAO,qCAC/H,SAAO,IAAIA,QAAQ,SAAA/C,GACjB,IAAMgD,EAAoBE,EAAmBxE,GAAcwE,EAAmBxE,IAAe,IACvEsE,EAAkBpF,GAAcoF,EAAkBpF,IAAe,IACzE6B,KAAK,CAAEN,QAAOA,EAAEa,QAAOA,EAAEV,YAAWA,YAQtDnD,EAAAiH,qBAAA,SAAqC1E,EAAoBd,GACvD,IAAMoF,EAAoBE,EAAmBxE,GAC7C,GAAKsE,EAEL,GAAIpF,EAAK,CACP,IAAMkB,EAAgBkE,EAAkBpF,GACxCqC,EAAAL,gBAAgBlB,EAAYd,EAAKkB,EAAe4D,EAAA7C,kBAGhD9C,OAAO+E,KAAKkB,GAAmBlD,QAAQ,SAAAmB,GACrC,IAAMnC,EAAgBkE,EAAkB/B,GACxChB,EAAAL,gBAAgBlB,EAAYuC,EAAGnC,EAAe4D,EAAA7C","file":"global-store.es5.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","import { compareVersion } from './compareVersion';\nimport { StoreInitializer, StoreValue, StoreVersion } from './types';\nimport { StoreCreator, StoreId, Stores } from './typesInternal';\n\nexport function getStoreValue(stores: Stores, id: StoreId): any {\n  return getStore(stores, id).value\n}\n\nexport function initStoreValue<T extends StoreValue>(stores: Stores, id: StoreId, version: StoreVersion, initializer: StoreInitializer<T>) {\n  const store = getStore(stores, id)\n  if (!~store.versions.indexOf(version)) {\n    store.initializers.push(initializer)\n    store.value = initializer(store.value as T, store.versions)\n    store.versions.push(version)\n  }\n}\n\nexport function resetStoreValue(stores: Stores, id: StoreId) {\n  const store = getStore(stores, id)\n  const versions = store.versions\n  store.versions = []\n  store.value = store.initializers.reduce((value, initializer, i) => {\n    value = initializer(value, store.versions)\n    store.versions.push(versions[i])\n    return value\n  }, {})\n}\n\nexport function getStore(stores: Stores, id: StoreId) {\n  const moduleStore = stores[id.moduleName] = stores[id.moduleName] || {}\n  return moduleStore[id.key as any] = moduleStore[id.key as any] || { versions: [], value: {}, initializers: [] }\n}\n\nexport function resolveCreators<S>(moduleName: string, key: string, storeCreators: Array<StoreCreator<S>>, createStore: any) {\n  sortByVersion(storeCreators).forEach(({ version, resolve, initializer }) => resolve(createStore({ moduleName, key, version, initializer })))\n}\n\nexport function sortByVersion<S>(storeCreators: Array<StoreCreator<S>>) {\n  return storeCreators.sort((a, b) => compareVersion(a.version, b.version))\n}\n","import { StoreOptions, StoreValue } from './types';\nimport { Stores } from './typesInternal';\nimport { getStoreValue, initStoreValue, resetStoreValue } from './util';\n\nexport type Store<T extends StoreValue> = {\n  /**\n   * Value from the store.\n   */\n  readonly value: T\n  /**\n   * Resets the store to its initial value.\n   * You should only use this during testing.\n   */\n  reset(): void\n}\n\nconst stores: Stores = {}\n\n/**\n * Creates a store of type T.\n * https://github.com/unional/global-store#createstore\n */\nexport function createStore<\n  T extends StoreValue\n>({ moduleName, key, version, initializer }: StoreOptions<T>): Store<T> {\n  initStoreValue(stores, { moduleName, key }, version, initializer)\n\n  return {\n    get value() { return getStoreValue(stores, { moduleName, key }) },\n    reset: () => resetStoreValue(stores, { moduleName, key })\n  }\n}\n","import { StoreVersion } from './types';\n\n/**\n * Compare version.\n * Positive when processed > current\n * Negative when processed < current\n */\nexport function compareVersion(processed: StoreVersion, current: StoreVersion) {\n  const v1 = toVersionArray(processed)\n  const v2 = toVersionArray(current)\n  return v1[0] !== v2[0] ? v1[0] - v2[0] :\n    v1[1] !== v2[1] ? v1[1] - v2[1] :\n      v1[2] - v2[2]\n}\n\nfunction toVersionArray(v: StoreVersion) {\n  return typeof v === 'number' ? [0, 0, v] :\n    v.split('.').map(v => Number.parseInt(v, 10))\n}\n","import { Store } from './createStore';\nimport { AccessedBeforeLock, Prohibited } from './errors';\nimport { StoreOptions, StoreValue } from './types';\nimport { StoreId, Stores } from './typesInternal';\nimport { getStore, getStoreValue, initStoreValue, resetStoreValue } from './util';\n\nconst readonlyStores: Stores = {}\n\nexport type ReadonlyStore<T extends StoreValue> = Store<T> & {\n  /**\n   * Gets a writable value from the store.\n   * This can be used to set the store value before it is locked.\n   * This is useful if your configuration is distributed in nature.\n   * When configuration is completed,\n   * you should `lock()` the store and access through `value`.\n   */\n  readonly writeable: T\n  /**\n   * Disable the readonly feature of the store.\n   * Calling this function will make the store not readonly.\n   * It will behaves just like the normal `Store`.\n   * Obviously, you should only call this during testing.\n   */\n  disableProtection(): void,\n  /**\n   * Lock the store so that it cannot be modified.\n   * @param finalizer A finalizer object to do a final process of the value.\n   * You can use this to change the value, or freeze object.\n   * By default, the value itself will be frozen,\n   * If it contains array properties, those will also be frozen.\n   */\n  lock(finalizer?: Partial<{ [K in keyof T]: (value: T[K]) => T[K] }> & Record<keyof any, (value: any) => any>): ReadonlyStore<T>\n}\n\n/**\n * Creates a readonly store of type T.\n * https://github.com/unional/global-store#createreadonlystore\n */\nexport function createReadonlyStore<\n  T extends StoreValue\n>({ moduleName, key, version, initializer }: StoreOptions<T>): ReadonlyStore<T> {\n  initStoreValue(readonlyStores, { moduleName, key }, version, initializer)\n  let isLocked = false\n  let disabled = false\n  return {\n    disableProtection() {\n      if (isLocked) throw new Prohibited(moduleName, 'ReadonlyStore#disableProtection')\n      disabled = true\n    },\n    get value() {\n      if (!disabled && !isLocked) throw new AccessedBeforeLock(moduleName)\n      return getStoreValue(readonlyStores, { moduleName, key })\n    },\n    get writeable() {\n      if (!disabled && isLocked) throw new Prohibited(moduleName, 'ReadonlyStore#getWritable')\n      return getStoreValue(readonlyStores, { moduleName, key })\n    },\n    lock(finalizer) {\n      if (!disabled && !isLocked) {\n        if (finalizer) {\n          updateStoreValue(readonlyStores, { moduleName, key }, finalizer)\n        }\n        freezeStoreValue(readonlyStores, { moduleName, key })\n        isLocked = true\n        disabled = false\n      }\n      return this\n    },\n    reset() {\n      if (!disabled && isLocked) throw new Prohibited(moduleName, 'ReadonlyStore#reset')\n      resetStoreValue(readonlyStores, { moduleName, key })\n    }\n  }\n}\n\n\nfunction updateStoreValue(stores: Stores, id: StoreId, finalizer: Record<keyof any, (prev: any) => any>) {\n  const current = getStoreValue(stores, id)\n  Object.keys(finalizer).forEach(k => current[k] = finalizer[k](current[k]))\n}\n\nfunction freezeStoreValue(stores: Stores, id: StoreId) {\n  const store = getStore(stores, id)\n  store.value = freezeValue(store.value)\n}\n\nfunction freezeValue(storeValue: StoreValue) {\n  Object.keys(storeValue).forEach(k => freezeArray(storeValue, k))\n  // istanbul ignore next\n  if (Object.getOwnPropertySymbols) {\n    Object.getOwnPropertySymbols(storeValue).forEach(k => freezeArray(storeValue, k))\n  }\n\n  return Object.freeze(storeValue)\n}\n\nfunction freezeArray(storeValue: StoreValue, k: any) {\n  const value = storeValue[k]\n  if (Array.isArray(value)) {\n    storeValue[k] = Object.freeze(value)\n  }\n}\n","export class Prohibited extends Error {\n  constructor(public moduleName: string, public action: string) {\n    super(`Unable to perform '${action}' on a locked store from module '${moduleName}'`)\n\n    Object.setPrototypeOf(this, new.target.prototype)\n  }\n}\n\nexport class AccessedBeforeLock extends Error {\n  constructor(public moduleName: string) {\n    super(`A readonly store from '${moduleName}' is being accessed before it is locked. Please call the approprate function in '${moduleName}' to lock the store.`)\n\n    Object.setPrototypeOf(this, new.target.prototype)\n  }\n}\n","export * from './compareVersion';\nexport * from './createAsyncReadonlyStore';\nexport * from './createAsyncStore';\nexport * from './createReadonlyStore';\nexport * from './createStore';\nexport { createStore as default } from './createStore';\nexport * from './errors';\nexport * from './types';\n","import { createReadonlyStore, ReadonlyStore } from './createReadonlyStore';\nimport { StoreOptions, StoreValue } from './types';\nimport { StoreCreators } from './typesInternal';\nimport { resolveCreators } from './util';\n\nconst asyncReadonlyStoreCreators: StoreCreators<ReadonlyStore<any>> = {}\n\n/**\n * Creates a readonly store of type T.\n * https://github.com/unional/global-store#createAsyncReadonlyStore\n */\nexport function createAsyncReadonlyStore<T extends StoreValue>(\n  { moduleName, key, version, initializer }: StoreOptions<T>): Promise<ReadonlyStore<T>> {\n  return new Promise(resolve => {\n    const creatorsOfModules = asyncReadonlyStoreCreators[moduleName] = asyncReadonlyStoreCreators[moduleName] || {}\n    const storeCreators = creatorsOfModules[key as any] = creatorsOfModules[key as any] || []\n    storeCreators.push({ version, resolve, initializer })\n  })\n}\n\n/**\n * Initializes the stores for `createAsyncReadonlyStore()`.\n * https://github.com/unional/global-store#initializeAsyncReadonlyStore\n */\nexport function initializeAsyncReadonlyStore(moduleName: string, key?: string) {\n  const creatorsOfModules = asyncReadonlyStoreCreators[moduleName]\n  if (!creatorsOfModules) return\n\n  if (key) {\n    const storeCreators = creatorsOfModules[key as any]\n    resolveCreators(moduleName, key, storeCreators, createReadonlyStore)\n  }\n  else {\n    Object.keys(creatorsOfModules).forEach(k => {\n      const storeCreators = creatorsOfModules[k]\n      resolveCreators(moduleName, k, storeCreators, createReadonlyStore)\n    })\n  }\n}\n","import { createStore, Store } from './createStore';\nimport { StoreOptions, StoreValue } from './types';\nimport { resolveCreators } from './util';\nimport { StoreCreators } from './typesInternal';\n\nconst asyncStoreCreators: StoreCreators<Store<any>> = {}\n\n/**\n * Creates a store of type T asychronously.\n * https://github.com/unional/global-store#createAsyncStore\n */\nexport async function createAsyncStore<T extends StoreValue>({ moduleName, key, version, initializer }: StoreOptions<T>): Promise<Store<T>> {\n  return new Promise(resolve => {\n    const creatorsOfModules = asyncStoreCreators[moduleName] = asyncStoreCreators[moduleName] || {}\n    const storeCreators = creatorsOfModules[key as any] = creatorsOfModules[key as any] || []\n    storeCreators.push({ version, resolve, initializer })\n  })\n}\n\n/**\n * Initializes the stores for `createAsyncStore()`.\n * https://github.com/unional/global-store#initializeAsyncStore\n */\nexport function initializeAsyncStore(moduleName: string, key?: string) {\n  const creatorsOfModules = asyncStoreCreators[moduleName]\n  if (!creatorsOfModules) return\n\n  if (key) {\n    const storeCreators = creatorsOfModules[key as any]\n    resolveCreators(moduleName, key, storeCreators, createStore)\n  }\n  else {\n    Object.keys(creatorsOfModules).forEach(k => {\n      const storeCreators = creatorsOfModules[k]\n      resolveCreators(moduleName, k, storeCreators, createStore)\n    })\n  }\n}\n"],"sourceRoot":""}